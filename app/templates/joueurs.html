{% extends "parent.html" %}
{% import "macro_form.html" as macros %}

{% block content %}
<script type="text/javascript">
  // main function
  $(document).ready(function(){
    // changer le status d'un joueur
    $("#playerTable").on("click", ".status", function(){
      // récupérer l'id du jouer
      var tmp = $(this).attr("id").replace("status", "")
      // Ajax pour changer le joueur avec 3 retours selon le nouveau statut du joueur
      // 1 : admin -- 0 : membre -- 2 : le joueur est lui-même
      $.ajax({
        data : {
          id : tmp
        },
        type : "POST",
        url : "/changeStatus",
        success : function(data){
          var res = JSON.parse(data)
          // changer son status
          if(res == 2){
            alert("Vous ne pouvez pas changer votre propre status.")
          }else{
            $("#status"+tmp).empty()
            if(res == 1){
              $("#status"+tmp).append("ADMIN")
            }else if(res == 0){
              $("#status"+tmp).append("MEMBRE")
            }
          }
        }
      })
    })
  })
</script>

<div class="content" style="margin-top: 70px;">

  {% with messages = get_flashed_messages(with_categories=true, category_filter="info")%}
    {% if messages %}
      <ul class="flashes">
        {% for c, m in messages %}
          <li class="flash_message" style="color: Red;">{{c}} : {{m}}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <h1>Liste de force du club</h1>
  <table class="table" id="playerTable">
    <tr class="thead-light">
      <th>Pseudo</th>
      <th>Catégorie</th>
      {% if current_user.isAdmin() %}
        <th>Option</th>
      {% endif %}
    </tr>
    {% for player in players %}
      {{macros.showPlayer(player, current_user)}}
    {% endfor %}
  </table>
</div>
{% endblock %}
